<script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>

<script type="text/javascript">
    // autoComplete.js on type event emitter
    /*document.querySelector("#autoComplete").addEventListener("autoComplete", function (event) {
        console.log(event.detail);
    });*/

    // The autoComplete.js Engine instance creator
    const autoCompletejs = new autoComplete({
        data: {
            src: async function () {
                // Loading placeholder text
                document.querySelector("#autoComplete").setAttribute("placeholder", "Loading...");
                // Fetch External Data Source                    
                const source = await fetch("#URL_SITE_SPIP/#URL_PAGE{json}&id_rubrique=#ENV{id_rubrique}");
                const data = await source.json();
                console.log("Caricati i dati");
                // Returns Fetched data
                return data;
            },
            key: ["title"]
        },
        sort: (a, b) => {                    // Sort rendered results ascendingly | (Optional)
            if (a.match < b.match) return -1;
            if (a.match > b.match) return 1;
            return 0;
        },
        placeHolder: "[(#TITRE)]",
        selector: "#autoComplete",
        searchEngine: "loose",
        resultsList: {                       // Rendered results list object      | (Optional)
            render: true,
            /* if set to false, add an eventListener to the selector for event type
               "autoComplete" to handle the result */
            container: source => {
                source.setAttribute("id", "article_list");
            },
            destination: document.querySelector("#autoComplete"),
            position: "afterend",
            element: "ul"
        },
        onSelection: function (feedback) {
            document.querySelector("#autoComplete").blur();
            //const selection = feedback.selection.value.food;
            // Render selected choice to selection div
            //document.querySelector(".selectionq").innerHTML = selection;
            // Clear Input
            //document.querySelector("#autoComplete").value = "";
            // Change placeholder with the selected value
            //document.querySelector("#autoComplete").setAttribute("placeholder", selection);
            // Concole log autoComplete data feedback
            console.log("----");
            console.log(feedback.selection.value.id);
            console.log("----");
        },
    });
</script>